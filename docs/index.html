<!DOCTYPE html>
<html>

<head>

  <meta name="description" content="Some interactive maps made with D3.js">
  <meta name="author" content="Cornelia Gamst">

  <meta property="og:title" content="Maps with D3.js">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://gamst.github.io/d3-maps">
  <meta property="og:description" content="Some interactive maps made with D3.js">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
  <!-- <meta property="og:image" content="/warnstreik-gew/image.jpg">

    <link rel="icon" type="image/png" href="/warnstreik-gew/strike.png"> -->

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>D3 Maps</title>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      font-size: 14px;
    }

    path {
      stroke: white;
      stroke-width: 0.5px;
      fill: #3A2A78;
    }

    path:hover {
      fill: #6c609a;
    }

    svg {
      border: 2px solid #000;
      border-radius: 5px;
    }

    .city {
      font-weight: bold;
      padding: 10px;
    }

    .accordion {
      background-color: #DFDFDF;
      color: #444;
      cursor: pointer;
      width: 100%;
      text-align: left;
      border: none;
      outline: none;
      transition: 0.4s;
      border-top: 1px solid grey;
      padding: 10px;
    }

    .active,
    .accordion:hover {
      background-color: #ccc;
    }

    .panel {
      padding: 0 18px;
      background-color: #B7B7B7;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.2s ease-out;
      font-size: 13px;
      color: #444;
    }

    .accordion:after {
      content: "\2193";
      font-size: 11px;
      color: #777;
      float: right;
      margin-left: 5px;
    }

    .active:after {
      content: "\2191";
    }

    .dot {
      width: 9px;
      height: 9px;
      border-radius: 100%;
      display: inline-block;
      margin-right: 5px;
    }

    .green {
      background-color: green;
    }

    .blue {
      background-color: blue;
    }

    .white {
      background-color: white;
    }
  </style>

  <script src="https://d3js.org/d3.v3.min.js"></script>
  <script src="https://d3js.org/topojson.v0.min.js"></script>
</head>

<body>
  <script type="text/javascript">
    function showInformation(element) {
      element.classList.toggle("active");
      var panel = element.nextElementSibling;
      if (panel.style.maxHeight) {
        panel.style.maxHeight = null;
      } else {
        panel.style.maxHeight = panel.scrollHeight + "px";
      }
    }

    var width = 900;
    var height = 700;

    var svg = d3.select("body").append("svg")
      .attr("width", width)
      .attr("height", height);

    var tooltip = d3.select("body").append("div")
      .style("position", "absolute")
      .style("z-index", "10")
      .style("display", "none")
      .style("background", "#EAF4F8")
      .attr("class", "tooltip")
      .on('mouseleave', function () { return tooltip.style("display", "none"); });

    var cities = [
      {
        code: "BER",
        city: "Berlin",
        institutions: ["Stifterverband", "HU Berlin"],
        country: "Germany",
        lat: 52.52,
        lon: 13.405,
        person: "person 1",
        study_track: "study 1",
        category: "Konsortialpartner"
      },
      {
        code: "HGN",
        city: "Hagen",
        institutions: ["FernUniversit√§t in Hagen"],
        country: "Germany",
        lat: 51.367,
        lon: 7.463,
        person: "person 2",
        study_track: "study 2",
        category: "Lernangebot"
      },
      {
        code: "SAA",
        city: "Saarbrücken",
        institutions: ["Neocosmo"],
        country: "Germany",
        lat: 49.42,
        lon: 6.997,
        person: "person 3",
        study_track: "study 3",
        category: "Fellowship"
      },
      {
        code: "HLB",
        city: "Heilbronn",
        institutions: ["DHBW Heilbronn"],
        country: "Germany",
        lat: 49.142,
        lon: 9.211,
        person: "person 4",
        study_track: "study 4",
        category: "Nutzungspartner"
      }
    ];

    //changing the projection from mercator to albers
    var projection = d3.geo.albers()
      .center([11, 50.7])
      .rotate([0, 0])
      .parallels([50, 10])
      .scale(4000)
      .translate([width / 2, height / 2]);

    var path = d3.geo.path()
      .projection(projection);

    var g = svg.append("g");

    d3.json("https://raw.githubusercontent.com/deldersveld/topojson/master/countries/germany/germany-regions.json", function (error, topology) {
      g.selectAll("path")
        .data(topojson.object(topology, topology.objects.DEU_adm2)
          .geometries)
        .enter()
        .append("path")
        .attr("d", path)
        .attr('fill', 'gray')

      // add city location circles
      var locations = g.selectAll("circle")
        .data(cities)
        .enter()
        .append("circle")
        .attr("cx", function (d) { return projection([d.lon, d.lat])[0]; })
        .attr("cy", function (d) { return projection([d.lon, d.lat])[1]; })
        .attr("r", 5)
        .style("fill", "#17a468")
        .style("opacity", 0.6)
        .on('mouseover', function (d) {
          tooltipIsVisible = true;
          d3.select(this).style('fill', '#EAF4F8');
          let category = "";
          if (d.category === "Konsortialpartner" || d.category === "Nutzungspartner") {
            category = "blue";
          } else if (d.category === "Fellowship") {
            category = "green";
          } else if (d.category === "Lernangebot") {
            category = "white";
          }
          const city = `<div class="city">${d.city}</div>`;
          const institutions = d.institutions.map((institution) => `
                <button class="accordion" onclick="showInformation(this)">
                  <div class="dot ${category}"></div>${institution}
                </button>
                <div class="panel">
                  <p>Person: ${d.person}</p>
                  <p>Study track: ${d.study_track}</p>
                </div>
              `).join('');
          tooltip.html(city + institutions);
          tooltip.style("top", (d3.event.pageY - 10) + "px").style("left", (d3.event.pageX - 3) + "px")
          return tooltip.style("display", "block");
        })
    });

    //zoom and pan functionality
    var zoom = d3.behavior.zoom()
      .scaleExtent([1, 6])
      .on("zoom", function () {
        g.attr("transform", "translate(" + d3.event.translate.join(",") + ")scale(" + d3.event.scale + ")");
        g.selectAll("path")
          .attr("d", path.projection(projection));
      });
    svg.call(zoom);


  </script>
</body>

</html>